= OMERO CSV Annotation Tool User Documentation
Imagopole
:artifact_version: 0.2.2
:bintray_artifact_url: https://bintray.com/imagopole/omero/omero-csv-tools/
:bintray_examples_dist_url: https://dl.bintray.com/imagopole/omero/omero-csv-tools/dist/omero-csv-tools-{artifact_version}-examples.zip
:toc:


[[introduction]]
== Overview

--
This document is a guide to the OMERO CSV Annotation Tool features, as part of the OMERO structured
annotations ecosystem.
--


[[overview]]
== Introduction to OMERO annotations

[[overview-strucured-annotations]]
=== OMERO and structured annotations

Examples of how you can annotate your data as an OMERO user:

* Tag, rate or comment on your projects / datasets / images individually using the graphical user
  interface in OMERO.insight or OMERO.web.
* Let the webtagging tool automatically suggest tags from your image names for you to review and
  apply interactively in OMERO.web.
* Bulk annotate your datasets and images in an unattended manner using the CSV tool script in
  OMERO.insight or OMERO.web.

[[overview-omero-annotations]]
=== OMERO clients annotations

For general usage of annotations in OMERO, please see the OME tutorial at
http://help.openmicroscopy.org/managing-data.html

[[overview-omero-webtagging]]
=== OMERO webtagging

For detailed instructions on how to use the webtagging tool, please see the tool's documentation at
http://www.openmicroscopy.org/site/support/partner/omero.webtagging

[[overview-omero-cat]]
=== OMERO CSV annotation tool

Workflow outline (details below):

. Attach the tag definitions in CSV format to your OMERO project or dataset.
. Run the CSV annotation tool script on the project or dataset.


[[main-omero-cat]]
== CSV annotation tool usage guidelines

[[synopsis-omero-cat]]
=== Synopsis for the impatient

[format="csv", options="header"]
|===
In order to tag, Attach CSV file to, Default file name will be, Default separator will be, CSV header will be ignored?
images, dataset, image_tag.csv, comma, yes
datasets, project, dataset_tag.csv, comma, yes
|===

[[supported-omero-cat]]
=== Supported features

The annotation tool relies on the file attachment mechanism provided by OMERO to retrieve the CSV file remotely.

In its current form, it follows OMERO's hierarchical Project / Dataset / Image organisation scheme to relate
the CSV file to the candidates for annotation.
The tool currently allows:

* tagging *datasets* nested _within_ a *project* (ie. ``orphans'' or ``top-level'' datasets are
  currently not supported, but may be at a later stage)
* tagging *images* nested _within_ a *dataset* (whether the dataset is nested within a project or not)
* attaching the CSV file to a *project* or a *dataset* (in order to annotate _datasets_ and _images_,
  respectively)

==== Example data layout

Assuming the following hierarchy and CSV attachments:

----
MyOmeroGroup
  +-- Project-P0  .................  dataset_tag_P0.csv
  |     +-- Dataset-D1  ...........  image_tag_D1.csv
  |     |     +-- Image-D1.1
  |     |     +-- Image-D1.2
  |     +-- Dataset-D2
  +-- Dataset-DN  .................  image_tag_DN.csv
        +-- Image-DN1.1
        +-- Image-DN1.2
----

The available tagging combinations would be:

[width="100%", cols="3", options="header"]
|========================================================================
|CSV attachment         2+|Candidates for tagging
|+dataset_tag_P0.csv+    |All datasets within +Project-P0+ |+Dataset-D1+
|                        |                                 |+Dataset-D2+
|+image_tag_D1.csv+      |All images within +Dataset-D1+   |+Image-D1.1+
|                        |                                 |+Image-D1.2+
|+image_tag_DN.csv+      |All images within +Dataset-DN+   |+Image-DN.1+
|                        |                                 |+Image-DN.2+
|========================================================================

NOTE: CSV attachments names above have been customized to reflect the project or dataset they are
linked to for readability only - in practice, using the default naming for all ranks in the hierarchy
would work equally.

[[conventions-omero-cat]]
=== Data management conventions

==== Tags file name

If you don't use a specific file name, a default naming scheme is applied.

The default name will be: *+<annotated-type>_<annotation-type>.csv+*, with *+annotated-type+* and
*+annotation-type+* being the supported script arguments.

Example default file names:

* File containing at least one _tag_ to be applied to at least one _dataset_: *dataset_tag.csv*
* File containing at least one _tag_ to be applied to at least one _image_: *image_tag.csv*

The file content is consequently expected to be of homogenous nature: you cannot mix tags to be
applied to images and datasets in the same file (you would need two files for this).

==== Tags file format

The CSV format is expected to be in the form of:

* An optional column header (ignored by default)
* A line per tagging request, with:
  ** The annotated name as the first column (ie. dataset name or image name)
  ** Any number of tags names as the remaining columns (at least one)

Other default file format parameters which you can customise are:

[width="50%", options="header"]
|====================================
|Parameter            |Default value
|Ignore columns header|true
|Delimiter character  |Comma (,)
|Character encoding   | UTF-8
|====================================

==== Example files

* Example CSV file using the default comma delimiter and a column header
  (link:files/dataset_tag.csv[download])

NOTE: This is currently the default format in use.

----
Dataset Name, Type, Gender
dataset_01, ControlSubject, Female
dataset_02, Male
----

* Example CSV file using an alternate semicolon delimiter and no header
  (link:files/dataset_tag_semicolon_noheader.csv[download])

----
dataset_01;ControlSubject;Female
dataset_02;Male
----

* CSV files bundle

Download all CSV files from the {bintray_examples_dist_url}[examples zip distribution].


[[tutorial-omero-cat]]
=== Usage tutorial

==== Upload CSV tags file

Use the attachments interface

image::images/attach-file.png[Attach file]

==== Tagging datasets

Attach your tag file to your OMERO project, either with the default name or a name of your choice.

==== Tagging images

Attach your tag file to your OMERO dataset, either with the default name or a name of your choice.

==== Start the CSV annotation tool

* Navigate to the relevant OMERO.scripts menu

image::images/script-menu.png[Script menu]

* Customize the input parameters and launch

image::images/script-ui.png[Script GUI]


[[appendices]]
== Appendices

=== Distribution packages overview

All packages are downloadable from {bintray_artifact_url}, including a version of this manual and examples:

[width="100%", options="header"]
|===================================================================================================================================================================
|Distribution file name                                           |Description                                       |Includes documentation | Includes CSV samples
|+omero-csv-tools-<VERSION>-<OMERO_FLAVOR>-standalone.zip+        |Full package for single jar file installation     |Y                      |Y
|+omero-csv-tools-<VERSION>-<OMERO_FLAVOR>-with-dependencies.zip+ |Full package for multiple jar files installation  |Y                      |Y
|+omero-csv-tools-<VERSION>-docs-with-examples.zip+               |Documentation package with sample data            |Y                      |Y
|+omero-csv-tools-<VERSION>-examples.zip+                         |Example CSV data only                             |N                      |Y
|===================================================================================================================================================================
